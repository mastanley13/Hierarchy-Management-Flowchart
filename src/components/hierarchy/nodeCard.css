.node-card {
  position: relative;
  display: grid;
  grid-template-columns: auto auto 1fr auto;
  align-items: center;
  gap: 12px;
  padding: var(--card-padding-cozy);
  width: 340px;
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  color: var(--text-primary);
  transition: background 140ms ease, transform 140ms ease, box-shadow 140ms ease, opacity 160ms ease;
  border: 2px solid transparent;
  border-image-slice: 1;
}

.node-card.nodrag {
  cursor: default;
}

/* Light theme refinements */
.visual-hierarchy-page[data-theme='light'] .node-card {
  box-shadow: 0 10px 18px rgba(15, 23, 42, 0.08);
}

.visual-hierarchy-page[data-theme='light'] .node-card__name {
  color: #0f172a;
}

.visual-hierarchy-page[data-theme='light'] .node-card__summary {
  color: #64748b;
}

.visual-hierarchy-page[data-theme='light'] .node-card__meta {
  color: #64748b;
}

.visual-hierarchy-page[data-theme='light'] .node-card__toggle {
  border: 1px solid #cbd5e1;
  background: #ffffff;
  color: #475569;
}

.visual-hierarchy-page[data-theme='light'] .node-card__toggle:hover {
  border-color: #94a3b8;
  background: #f8fafc;
}

.visual-hierarchy-page[data-theme='light'] .node-card__actions {
  border: 1px solid #cbd5e1;
  background: #ffffff;
  color: #334155;
}

.visual-hierarchy-page[data-theme='light'] .node-card__actions:hover {
  color: #0f172a;
}

.node-card[data-density='compact'] {
  padding: var(--card-padding-compact);
  width: 320px;
}

.node-card[data-density='comfortable'] {
  padding: var(--card-padding-comfortable);
  width: 360px;
}

.node-card:hover {
  background: var(--bg-card-hover);
  transform: translateY(-2px);
}

.node-card:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 4px;
  background: var(--bg-card-focus);
}

.node-card.is-selected {
  box-shadow: 0 0 0 2px var(--edge-highlight), var(--shadow);
}

.node-card.is-dimmed {
  opacity: 0.35;
}

.node-card__toggle {
  width: 30px;
  height: 30px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(21, 25, 33, 0.85);
  color: var(--text-secondary);
  cursor: pointer;
  transition: transform 160ms ease, border 160ms ease, background 160ms ease;
}

.node-card__toggle:hover {
  transform: scale(1.02);
  border-color: rgba(255, 255, 255, 0.25);
}

.node-card__avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: #232a36;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  letter-spacing: 0.02em;
  color: var(--accent);
}

.visual-hierarchy-page[data-theme='light'] .node-card__avatar {
  background: #e9eef6;
}

.node-card__body {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.node-card__title-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
}

.node-card__title-row--stacked {
  flex-direction: column;
  gap: 2px;
}

.node-card__name {
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--text-primary);
}

.node-card__summary {
  font-size: 0.78rem;
  font-weight: 500;
  letter-spacing: 0.02em;
  color: rgba(224, 235, 255, 0.82);
}

.node-card__meta {
  font-size: 0.7rem;
  color: var(--text-secondary);
  letter-spacing: 0.02em;
}

.node-card__badges {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 2px;
}

.node-card__tag {
  font-size: 0.65rem;
  padding: 2px 6px;
  border-radius: 999px;
  background: rgba(148, 163, 184, 0.2);
  color: rgba(226, 232, 240, 0.9);
  letter-spacing: 0.02em;
}

.visual-hierarchy-page[data-theme='light'] .node-card__tag {
  background: rgba(15, 23, 42, 0.08);
  color: #0f172a;
}

.node-card__tag--upline {
  background: rgba(96, 245, 161, 0.18);
  color: #60f5a1;
}

.visual-hierarchy-page[data-theme='light'] .node-card__tag--upline {
  background: #dcfce7;
  color: #166534;
}

.node-card__tag--synthetic {
  background: rgba(59, 130, 246, 0.2);
  color: #7dd3fc;
}

.visual-hierarchy-page[data-theme='light'] .node-card__tag--synthetic {
  background: #dbeafe;
  color: #1d4ed8;
}

.node-card__tag--duplicate {
  background: rgba(248, 113, 113, 0.2);
  color: #fca5a5;
}

.visual-hierarchy-page[data-theme='light'] .node-card__tag--duplicate {
  background: #fee2e2;
  color: #991b1b;
}

.node-card__chip {
  font-size: 0.68rem;
  padding: 2px 8px;
  border-radius: 999px;
  background: var(--chip-inactive-bg);
  color: var(--chip-inactive-text);
  font-weight: 500;
  letter-spacing: 0.02em;
  text-transform: uppercase;
}

.node-card__chip--active {
  background: var(--chip-active-bg);
  color: var(--chip-active-text);
}

.node-card__chip--pending {
  background: var(--chip-pending-bg);
  color: var(--chip-pending-text);
}

.node-card__chip--summary {
  background: rgba(96, 245, 161, 0.12);
  color: var(--accent);
  text-transform: none;
}

.visual-hierarchy-page[data-theme='light'] .node-card__chip--summary {
  background: #ecfdf5;
  color: #065f46;
}

.node-card__actions {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(20, 24, 32, 0.8);
  color: var(--text-secondary);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.node-card__actions:hover {
  color: var(--text-primary);
}

.node-card__handle {
  width: 8px !important;
  height: 8px !important;
  border-radius: 999px;
  border: none;
  background: transparent;
  box-shadow: none;
  opacity: 1;
  left: 48px !important;
}

.node-card__handle::after {
  display: none;
}

.node-card__handle--top {
  top: -10px;
}

.node-card__handle--bottom {
  bottom: -10px;
}
